<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì ˆì£¼ì¼ê¸°</title>
  <link href="main.css" rel="stylesheet">
  <link rel="shortcut icon" href="ddrink1.png">
  <link rel="apple-touch-icon" sizes="128x128" href="ddrink1.png">
  <link rel="icon" sizes="192x192" href="ddrink1.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Hahmlet:wght@300&display=swap" rel="stylesheet">
</head>

<body>

  <h3>ì ˆì£¼ì¹­ì°¬ìŠ¤í‹°ì»¤ğŸº</h3>
  <p>ì´ <span class="count">0</span>ê°œ</p>
  <p>ë³´ìƒ : <input></p>
  <p>ì‹œì‘ì¼ : <input type="date" class="date"></p>
  <p>ê¸°ì¤€ : í•˜ë£¨ ë§¥ì£¼ 330ml ì´í•˜ ì„­ì·¨ì‹œ ìŠ¤í‹°ì»¤ ë°œë¶€ ê°€ëŠ¥</p>

  <style>
    /* css beforeëŠ” ì¡°ì‘ë¶ˆê°€, ë‹¤ë¥¸ ë ˆì´ì•„ì›ƒ ì°¾ì•„ì•¼í•¨ */
    
  </style>
  <main class="grid">
    <div class="grid-item"><span class="small">1234</span>
    </div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
    <div class="grid-item"></div>
  </main>

  <button class="btn reset">ë¦¬ì…‹</button>
  <button class="btn share" style="background: rgb(184, 227, 255); margin-left: 10px;">ê³µìœ </button>

  <script>

    document.querySelector('.share').addEventListener('click', function(){
      let a = localStorage.getItem('list')
      let val = document.querySelector('.date').value;
      window.history.pushState({}, null, '?start=' + val + '&a=' + a)
      navigator.clipboard.writeText('https://yogoho210.github.io/drink/?start='+ val +'&a='+a)
    })

    //ê³µìœ í•œ ë‚´ìš© ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥
    const urlParam = new URLSearchParams(window.location.search);
    if (urlParam.get('a') != null){

      let ê³µìœ ìš©ì‹œì‘ë‚ ì§œ = urlParam.get('start')
      document.querySelector('.date').value = ê³µìœ ìš©ì‹œì‘ë‚ ì§œ
      localStorage.setItem('date', ê³µìœ ìš©ì‹œì‘ë‚ ì§œ)
      let ê³µìœ ìš©ë°ì´í„° = JSON.parse(urlParam.get('a'))
      ê³µìœ ìš©ë°ì´í„°.forEach((a, i) => {
        document.querySelectorAll('.grid-item')[i].innerHTML = a;
      });
    }

    


    const getRandomEmoji = () => {

      const emojis = ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ¤£', 
      'ğŸ˜‚', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©', 
      'ğŸ˜˜', 'ğŸ˜—','ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ˜', 
      'ğŸ¤‘', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤', 'ğŸ¤¨', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 
      'ğŸ˜', 'ğŸ˜’', 'ğŸ™„', 'ğŸ˜¬', 'ğŸ˜®', 'ğŸ¤¥', 'ğŸ˜Œ', 'ğŸ˜”', 'ğŸ˜ª', 
      'ğŸ¤¤', 'ğŸ˜´', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ¥´', 'ğŸ˜µ', 'ğŸ¤¯', 
      'ğŸ¤ ', 'ğŸ¥³','ğŸ˜', 'ğŸ¤“', 'ğŸ§', 'ğŸ˜•', 'ğŸ˜Ÿ', 'ğŸ™', 'ğŸ˜®', 'ğŸ˜¯', 
      'ğŸ˜²', 'ğŸ˜³', 'ğŸ¥º', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜¢', 'ğŸ˜­', 
      'ğŸ˜–', 'ğŸ˜£', 'ğŸ¥±', 'ğŸ˜¤', 'ğŸ‘»', 'ğŸ˜º', 'ğŸ˜¸', 
      'ğŸ˜¹', 'ğŸ˜»', 'ğŸ˜¼', 'ğŸ˜½', 'ğŸ™€', 'ğŸ˜¿', 'ğŸ˜¾',
      'ğŸ’˜','ğŸ’','ğŸ’–','ğŸ’—','ğŸ’“','ğŸ’','ğŸ’•','ğŸ’Ÿ',
      'ğŸ’”','â¤','ğŸ§¡','ğŸ’›','ğŸ’š','ğŸ’™','ğŸ’œ','ğŸ¤','ğŸ–¤','ğŸ¤','ğŸ’¯',
      'ğŸ¶','ğŸ•','ğŸ¦®','ğŸ•â€ğŸ¦º','ğŸ©','ğŸº','ğŸ¦Š','ğŸ¦','ğŸ±','ğŸˆ','ğŸ¦',
      'ğŸ¯','ğŸ…','ğŸ†','ğŸ´','ğŸ','ğŸ¦„','ğŸ¦“','ğŸ¦Œ','ğŸ®','ğŸ‚','ğŸƒ','ğŸ„','ğŸ·']
      return emojis[~~(Math.random() * emojis.length)]
    } 
    //í˜ì´ì§€ë¡œë“œ
    if (localStorage.getItem('list') == null){
      localStorage.setItem('list', JSON.stringify([]))
    }

    //í˜ì´ì§€ë¡œë“œì‹œ DBêº¼ë‚´ì„œ ë””ìŠ¤í”Œë ˆì´
    let list = JSON.parse(localStorage.getItem('list'));
    list.forEach((a, i) => {
      document.querySelectorAll('.grid-item')[i].innerHTML = a;
    });

    //ìˆ˜ëŸ‰ì¹´ìš´íŠ¸
    document.querySelector('.count').innerHTML = list.length;
    
    let grid = document.querySelectorAll('.grid-item');
    

    for (let i = 0; i < grid.length; i++){
    
    document.querySelectorAll('.grid-item')[i].addEventListener('click', function(){
      
      if (document.querySelectorAll('.grid-item')[i].innerHTML != ''){
        
        list.splice(i, 1);
        document.querySelector('.count').innerHTML = list.length;
        
        //clear
        grid.forEach((a,i)=>{
          grid[i].innerHTML = ''
        });
        grid.forEach((a, j) => {
          if (list[j] != undefined) {
            document.querySelectorAll('.grid-item')[j].innerHTML = '<span>' + list[j] + '</span>';
          }
        });
        //ì‚­ì œì‹œ ë‹¤ì‹œ ë‚ ì§œ í‘œê¸°
        let val = document.querySelector('.date').value;
        ë‚ ì§œë‹¤ì‹œí‘œê¸°(val)
        localStorage.setItem('list', JSON.stringify(list)); 
        return;
      }
      
      let result = confirm("ì ˆì£¼í–ˆë‚˜ìš”?");
      if (result == true){
        let result2 = prompt("ì˜¤ëŠ˜ ìŒì£¼ëŸ‰ì„ ê¸°ë¡í•˜ì„¸ìš”");
        if (result2 != null) {
          list = JSON.parse(localStorage.getItem('list'));
          list.push(getRandomEmoji() + ' <span class="small"> ' + result2 + '</span>');
          document.querySelector('.count').innerHTML = list.length;


          grid.forEach((a, j) => {
            if (list[j] != undefined) {
              document.querySelectorAll('.grid-item')[j].innerHTML = '<span>' + list[j] + ' </span>';
            }
          });

          //ê¸°ë¡í•˜ë©´ ë‚ ì§œë„ ë‹¤ì‹œí‘œê¸°
          let val = document.querySelector('.date').value;
          ë‚ ì§œë‹¤ì‹œí‘œê¸°(val)
          localStorage.setItem('list', JSON.stringify(list)); 
        }
      }
      
      
    })

    }


    document.querySelector('.reset').addEventListener('click', function(){
      clearHTML();
      localStorage.setItem('list', JSON.stringify([])); 
    })



    function clearHTML (){
      let result = confirm("ë¦¬ì…‹í• ê¹Œìš”?");
        if (result == true) {
        document.querySelector('.count').innerHTML = 0;
        grid.forEach((a,i)=>{
          grid[i].innerHTML = ''
        })
      }
    }


    //ë‚ ì§œí‘œê¸°ê¸°ëŠ¥
    //localstorageì— ìˆìœ¼ë©´ í‘œê¸°
    let ì‹œì‘ì¼ = localStorage.getItem('date')
    if (ì‹œì‘ì¼){
      document.querySelector('.date').value = ì‹œì‘ì¼;
      let gridSpan = document.querySelectorAll('span.small');  
      ì‹œì‘ì¼ = new Date(ì‹œì‘ì¼)  

      //spaníƒœê·¸ì•ˆì— ë‚ ì§œ í‘œê¸°
      let day;
      for (let i = 0; i < gridSpan.length; i++){
        ì‹œì‘ì¼ = new Date(document.querySelector('.date').value)
        day = new Date(ì‹œì‘ì¼.setDate(ì‹œì‘ì¼.getDate() + i)).toLocaleDateString().substr(6)
        gridSpan[i].innerHTML = gridSpan[i].innerHTML + 
        `<span class="daystamp" style="color:grey; font-size : 7px"> (${day})</span>` 
      }
      
    }
    //ë‚ ì§œì„ íƒì‹œ localstorage ì €ì¥ê¸°ëŠ¥
    document.querySelector('.date').addEventListener('input', function(){
      let val = document.querySelector('.date').value;
      localStorage.setItem('date', val)
      console.log(val)
      //spaníƒœê·¸ì•ˆì— ë‚ ì§œ í‘œê¸°
      ë‚ ì§œë‹¤ì‹œí‘œê¸°(val)
    })

    function ë‚ ì§œë‹¤ì‹œí‘œê¸°(val){
      let daystamp = document.querySelectorAll('span.daystamp');  
      for (let i = 0; i < daystamp.length; i++){
        daystamp[i].innerHTML = ''
      }
      let gridSpan = document.querySelectorAll('span.small');  
      let ì‹œì‘ì¼ = new Date(val)
      let day;
      for (let i = 0; i < gridSpan.length; i++){
        ì‹œì‘ì¼ = new Date(document.querySelector('.date').value)
        day = new Date(ì‹œì‘ì¼.setDate(ì‹œì‘ì¼.getDate() + i)).toLocaleDateString().substr(6)
        gridSpan[i].innerHTML = gridSpan[i].innerHTML + 
        `<span class="daystamp" style="color:grey; font-size : 7px"> (${day})</span>` 
      }
    }
    
  </script>


</body>

</html>